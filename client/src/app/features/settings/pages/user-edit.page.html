<section class="user-edit">
  <app-breadcrumbs></app-breadcrumbs>

  <header class="user-edit__hero">
    <div>
      <p class="user-edit__eyebrow">User administration</p>
      <h1>Edit user profile</h1>
      <p>
        Update access, roles, and preferences in a focused workspace. Changes are saved immediately for the selected teammate.
      </p>
    </div>
    <div class="user-edit__actions">
      <button type="button" pButton label="Back to users" class="p-button-text" routerLink="/app/settings/users"></button>
    </div>
  </header>

  <article class="user-edit__card" *ngIf="!loading(); else loadingState">
    <header>
      <div>
        <p class="eyebrow">Access controls</p>
        <h2>{{ user()?.fullName }}</h2>
      </div>
      <span class="user-edit__status" [ngClass]="user()?.isActive ? 'user-edit__status--active' : 'user-edit__status--inactive'">
        {{ user()?.isActive ? 'Active' : 'Inactive' }}
      </span>
    </header>

    <form [formGroup]="form" (ngSubmit)="onSave()" class="user-edit__form">
      <div class="form-grid">
        <label>
          <span>Full name</span>
          <input pInputText formControlName="fullName" placeholder="Jordan Patel" />
        </label>
        <label>
          <span>Email</span>
          <input pInputText formControlName="email" placeholder="user@example.com" />
        </label>
        <label>
          <span>Time zone</span>
          <p-select
            formControlName="timeZone"
            [options]="timezoneOptions"
            optionLabel="label"
            optionValue="value"
            appendTo="body"
          ></p-select>
        </label>
        <label>
          <span>Locale</span>
          <p-select
            formControlName="locale"
            [options]="localeOptions"
            optionLabel="label"
            optionValue="value"
            appendTo="body"
          ></p-select>
        </label>
        <label class="full-row">
          <span>Roles</span>
          <p-multiSelect
            formControlName="roleIds"
            [options]="rolesAsOptions()"
            optionLabel="label"
            optionValue="value"
            display="chip"
            appendTo="body"
            defaultLabel="Select roles"
          ></p-multiSelect>
        </label>
        <label class="switch-row">
          <span>Status</span>
          <p-toggleSwitch formControlName="isActive"></p-toggleSwitch>
        </label>
        <label class="full-row">
          <span>Temporary password</span>
          <div class="password-field">
            <input pInputText type="text" formControlName="temporaryPassword" placeholder="Optional" />
            <button type="button" pButton label="Generate" [disabled]="!canManageAdmin()" (click)="generatePassword()"></button>
          </div>
          <small *ngIf="generatedPassword()">Share once, then require reset on first login.</small>
        </label>
      </div>
      <div class="user-edit__cta">
        <button type="button" pButton label="Cancel" class="p-button-outlined" routerLink="/app/settings/users"></button>
        <button type="submit" pButton label="Save changes" icon="pi pi-check" [disabled]="saving() || !canManageAdmin()"></button>
      </div>
    </form>
  </article>

  <ng-template #loadingState>
    <div class="user-edit__loading">
      <div class="loading-bar" *ngFor="let _ of [0,1,2,3]"></div>
    </div>
  </ng-template>
</section>
