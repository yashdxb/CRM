<section class="roles">
  <!-- PrimeNG Breadcrumb -->
  <app-breadcrumbs></app-breadcrumbs>


  <div class="roles__banner">
    <div>
      <p class="roles__eyebrow">Access blueprints</p>
      <h1>Design roles with surgical control</h1>
      <p>
        Shape how admins, partner managers, sellers, finance, and support contribute without stepping on restricted
        data. Every permission is auditable and ready for production.
      </p>
    </div>
    <div class="roles__banner-actions">
      <button type="button" pButton label="Back to users" icon="pi pi-arrow-left" class="p-button-outlined" routerLink="/app/settings/users"></button>
      <button type="button" pButton label="Invite user" icon="pi pi-user-plus" routerLink="/app/settings/invite"></button>
    </div>
  </div>

  <section class="roles__grid">
    <article class="roles__panel roles__panel--list">
      <header>
        <div>
          <p class="eyebrow">Access profiles</p>
          <h2>{{ roles().length }} roles</h2>
        </div>
        <button type="button" pButton label="New role" icon="pi pi-plus" [disabled]="roleSaving() || !canManageAdmin()" routerLink="/app/settings/roles/new"></button>
      </header>

      <ng-container *ngIf="!loadingRoles(); else rolesLoading">
        <p-table
          class="crm-table crm-table--highlight roles-table"
          [value]="roles()"
          [tableStyle]="{ 'min-width': '100%' }"
          responsiveLayout="scroll"
          [styleClass]="'p-datatable-sm'"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>Role</th>
              <th>Permissions</th>
              <th>Type</th>
              <th class="text-right">Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-role>
            <tr>
              <td>
                <div class="role-cell">
                  <div class="role-cell__icon">
                    <i class="pi pi-shield"></i>
                  </div>
                  <div>
                    <p class="role-cell__name">{{ role.name }}</p>
                    <small class="muted">{{ role.description || 'No description' }}</small>
                  </div>
                </div>
              </td>
              <td>
                <div class="permission-chips">
                  <p-tag *ngFor="let permission of role.permissions.slice(0, 3)" [value]="permissionLabel(permission)" severity="info"></p-tag>
                  <p-tag *ngIf="role.permissions.length > 3" [value]="'+' + (role.permissions.length - 3)" severity="secondary"></p-tag>
                </div>
              </td>
              <td>
                <p-tag [value]="role.isSystem ? 'System' : 'Custom'" [severity]="role.isSystem ? 'warn' : 'success'"></p-tag>
              </td>
              <td class="text-right actions">
                <button
                  type="button"
                  pButton
                  icon="pi pi-pencil"
                  severity="secondary"
                  class="p-button-rounded p-button-text"
                  pTooltip="Edit role"
                  [disabled]="!canManageAdmin()"
                  [routerLink]="['/app/settings/roles', role.id, 'edit']"
                ></button>
                <button
                  type="button"
                  pButton
                  icon="pi pi-trash"
                  severity="danger"
                  class="p-button-rounded p-button-text"
                  pTooltip="Delete role"
                  [disabled]="role.isSystem || roleSaving() || !canManageAdmin()"
                  (click)="deleteRole(role)"
                ></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </ng-container>
      <ng-template #rolesLoading>
        <div class="loading-blocks">
          <p-skeleton height="48px" *ngFor="let _ of [0, 1, 2, 3]"></p-skeleton>
        </div>
      </ng-template>
    </article>
  </section>

</section>
