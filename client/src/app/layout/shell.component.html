
    <div class="shell" [ngClass]="{ 'shell--collapsed': nav.collapsed(), 'shell--topbar-hidden': nav.topbarHidden() }">
      <app-sidebar (toggleSidebar)="nav.toggleSidebar()" />

      <div class="body">
        <div class="shell-page-background" aria-hidden="true">
          <div class="shell-animated-orb orb-1"></div>
          <div class="shell-animated-orb orb-2"></div>
          <div class="shell-animated-orb orb-3"></div>
          <div class="shell-grid-pattern"></div>
        </div>
        <app-topbar 
          (toggleSidebar)="nav.toggleSidebar()" 
          (openQuickAdd)="openQuickAdd()" 
        />
        
        <!-- Show topbar button when hidden -->
        @if (nav.topbarHidden()) {
          <button 
            class="show-topbar-btn" 
            (click)="nav.toggleTopbar()" 
            title="Show topbar"
          >
            <i class="pi pi-chevron-down"></i>
          </button>
        }
        
        <div
          class="app-topbar-activity-strip"
          [class.is-active]="loadingOverlay.visible()"
          aria-hidden="true"
        ></div>

        <main class="content">
          <router-outlet />
        </main>

        <app-assistant-panel />

        <footer class="app-footer">
          <div class="footer-left">
            <span class="footer-brand">CRM Enterprise</span>
            <span class="footer-divider">•</span>
            <span class="footer-meta">Internal</span>
            <span class="footer-divider">•</span>
            <span class="footer-meta">v2.0</span>
          </div>
          <div class="footer-right">
            <span class="footer-chip">ENV: DEV</span>
            <a class="footer-link" href="mailto:support@northedgesystem.com">Support</a>
          </div>
        </footer>

        <app-toast />
      </div>
    </div>

    <!-- Global overlays -->
    <app-notification-container></app-notification-container>
    <app-command-palette></app-command-palette>
    <app-keyboard-shortcuts-modal></app-keyboard-shortcuts-modal>

    <app-quick-add-modal
      #quickAddModal
      [visible]="quickAddVisible()"
      [initialType]="quickAddType()"
      (close)="quickAddVisible.set(false)"
      (created)="onQuickAddCreated()"
    />

    <div class="global-loading-overlay" *ngIf="loadingOverlay.visible()">
      <p-progressSpinner
        styleClass="global-loading-spinner"
        strokeWidth="6"
        animationDuration=".8s"
        [style]="{ width: '86px', height: '86px' }"
      ></p-progressSpinner>
    </div>
  
