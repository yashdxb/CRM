<app-auth-shell>
  <div class="login-card">
    <div class="card-header">
      <div class="signal"></div>
      <div class="brand-logo">
        <img
          src="https://nedgtdal2.blob.core.windows.net/assets/branding/logo-v2.png"
          alt="North Edge CRM"
        />
      </div>
      <h1 class="card-title">Activate your license</h1>
      <p class="card-subtitle">Set your password to join your workspace.</p>
    </div>

    <div *ngIf="checkingInvite" class="status-pill">
      Checking invitation...
    </div>

    <div *ngIf="precheckMessage" class="status-pill error">
      {{ precheckMessage }}
    </div>

    <form *ngIf="!precheckMessage" [formGroup]="form" (ngSubmit)="submit()" class="login-form">
      <div class="form-group">
        <label class="form-label" for="newPassword">New password</label>
        <div class="input-wrapper">
          <input pInputText id="newPassword" type="password" formControlName="newPassword" placeholder="Enter your password" />
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="confirmPassword">Confirm new password</label>
        <div class="input-wrapper">
          <input pInputText id="confirmPassword" type="password" formControlName="confirmPassword" placeholder="Confirm your password" />
        </div>
      </div>

      <div *ngIf="status" class="status-pill" [class]="status.tone">
        {{ status.message }}
      </div>

      <button pButton type="submit" class="btn-submit" [disabled]="loading">
        <span *ngIf="!loading">Activate account</span>
        <span *ngIf="loading" class="loading-state">
          <p-progressSpinner styleClass="inline-spinner" strokeWidth="6" animationDuration="0.8s"></p-progressSpinner>
          Activating...
        </span>
      </button>
    </form>
  </div>

  <p-dialog
    [(visible)]="showSuccessDialog"
    [modal]="true"
    [closable]="false"
    [draggable]="false"
    [resizable]="false"
    styleClass="invite-success-dialog"
    header="Password updated"
  >
    <div class="dialog-body">
      <p>Your password has been set successfully. Please sign in to access your workspace.</p>
    </div>
    <ng-template pTemplate="footer">
      <button pButton type="button" class="btn-submit" (click)="goToLogin()">Go to login</button>
    </ng-template>
  </p-dialog>
</app-auth-shell>
