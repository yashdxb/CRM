<main class="landing" *ngIf="vm as viewModel">
  <div class="landing-bg" aria-hidden="true">
    <span class="orb orb-1"></span>
    <span class="orb orb-2"></span>
    <span class="orb orb-3"></span>
    <span class="grid-pattern"></span>
    <span class="noise-layer"></span>
  </div>
  <section class="shell nav-shell">
    <header class="topbar">
      <div class="brand">
        <img
          class="brand-logo"
          src="/assets/branding/logo-v2-light.png"
          alt="North Edge System"
        />
      </div>
      <div class="top-actions">
        <button pButton type="button" label="Sign In" class="ne-btn ne-btn--link" (click)="onSignIn()"></button>
      </div>
    </header>
  </section>

  <section class="shell hero">
    <div class="hero-copy">
      <div class="hero-brand">
        <span class="hero-brand-wordmark">North Edge</span>
        <span class="hero-brand-crm">CRM</span>
      </div>
      <h1>Run Your Pipeline<br />on Verified Truth</h1>
      <div class="hero-cta">
        <button pButton type="button" label="Book a Demo" class="ne-btn ne-btn--ghost" (click)="onWatchDemo()"></button>
      </div>
    </div>
    <div class="hero-visual">
      <article class="hero-panel hero-panel--preview">
        <div class="hero-preview-carousel" (click)="advanceHeroPreview()" (wheel)="onHeroPreviewWheel($event)">
          <div class="hero-preview-track" [style.transform]="'translateX(-' + (activeHeroPreview * 100) + '%)'">
            <div class="hero-preview-slide">
              <section class="preview-card preview-card--truth">
                <div class="preview-card-header">
                  <span class="preview-title">Truth Metrics</span>
                  <span class="preview-badge">83%</span>
                </div>
                <div class="truth-grid">
                  <div class="truth-cell">
                    <span class="truth-label">Truth Coverage</span>
                    <strong class="truth-value">83%</strong>
                  </div>
                  <div class="truth-cell">
                    <span class="truth-label">Confidence</span>
                    <strong class="truth-value truth-value--good">High</strong>
                  </div>
                  <div class="truth-cell">
                    <span class="truth-label">Time-to-Truth</span>
                    <strong class="truth-value">0.8d</strong>
                  </div>
                </div>
              </section>
            </div>

            <div class="hero-preview-slide">
              <section class="preview-card preview-card--pipeline">
                <div class="preview-card-header">
                  <span class="preview-title">Verified Pipeline</span>
                  <span class="preview-live">$65,070 defensible</span>
                </div>
                <div class="hero-panel-row">
                  <span class="key">Pipeline</span>
                  <span class="val">$120,500</span>
                </div>
                <div class="hero-panel-row emphasis">
                  <span class="key">Defensible</span>
                  <span class="val">$65,070</span>
                </div>
                <div class="hero-panel-row">
                  <span class="key">Win rate</span>
                  <span class="val">72%</span>
                </div>
              </section>
            </div>

            <div class="hero-preview-slide">
              <section class="preview-card preview-card--risk">
                <div class="preview-card-header">
                  <span class="preview-title">Risk Register</span>
                  <span class="preview-badge preview-badge--warn">9</span>
                </div>
                <div class="risk-preview-chips">
                  <span class="risk-chip risk-chip--high">High 3</span>
                  <span class="risk-chip risk-chip--medium">Medium 4</span>
                  <span class="risk-chip risk-chip--low">Low 2</span>
                </div>
                <div class="risk-preview-bars" aria-hidden="true">
                  <div class="risk-bar-row">
                    <span class="risk-bar-label">SLA</span>
                    <div class="risk-bar-track"><span class="risk-bar-fill risk-bar-fill--high" style="width: 78%"></span></div>
                    <strong class="risk-bar-value">1</strong>
                  </div>
                  <div class="risk-bar-row">
                    <span class="risk-bar-label">No next step</span>
                    <div class="risk-bar-track"><span class="risk-bar-fill risk-bar-fill--medium" style="width: 62%"></span></div>
                    <strong class="risk-bar-value">3</strong>
                  </div>
                  <div class="risk-bar-row">
                    <span class="risk-bar-label">Stale activity</span>
                    <div class="risk-bar-track"><span class="risk-bar-fill risk-bar-fill--low" style="width: 86%"></span></div>
                    <strong class="risk-bar-value">5</strong>
                  </div>
                </div>
                <div class="risk-preview-list">
                  <div class="risk-preview-item">
                    <span>At-risk deals</span>
                    <strong>9</strong>
                  </div>
                  <div class="risk-preview-item">
                    <span>No next step</span>
                    <strong>3</strong>
                  </div>
                  <div class="risk-preview-item">
                    <span>SLA breaches</span>
                    <strong>1</strong>
                  </div>
                </div>
              </section>
            </div>

            <div class="hero-preview-slide">
              <section class="preview-card preview-card--ai">
                <div class="preview-card-header">
                  <span class="preview-title">AI Execution Orchestration</span>
                  <span class="preview-live">Live queue</span>
                </div>
                <div class="ai-preview-row">
                  <div class="ai-preview-copy">
                    <strong>Recover breached first-touch SLAs</strong>
                    <small>1 lead missed SLA. Prioritize outreach today.</small>
                  </div>
                  <span class="ai-preview-chip ai-preview-chip--high">High risk</span>
                </div>
                <div class="ai-preview-row">
                  <div class="ai-preview-copy">
                    <strong>Reactivate stale opportunities</strong>
                    <small>9 opportunities inactive 7+ days.</small>
                  </div>
                  <span class="ai-preview-chip ai-preview-chip--medium">Review</span>
                </div>
              </section>
            </div>
          </div>
        </div>
        <div class="hero-preview-controls" aria-label="KPI preview carousel">
          <button
            *ngFor="let slide of heroPreviewSlides; let i = index"
            type="button"
            class="hero-preview-dot"
            [class.is-active]="activeHeroPreview === i"
            [attr.aria-label]="'Show ' + slide"
            [attr.aria-pressed]="activeHeroPreview === i"
            (click)="$event.stopPropagation(); goToHeroPreview(i)"
          ></button>
        </div>
      </article>
    </div>
  </section>

  <section class="shell final-cta">
    <h2>If You Can't Defend it, Don't forecast It.</h2>
  </section>

  <p-dialog
    [(visible)]="showDemoForm"
    [modal]="true"
    [dismissableMask]="false"
    [draggable]="false"
    [resizable]="false"
    [closeOnEscape]="true"
    [style]="{ width: 'min(860px, 96vw)' }"
    styleClass="demo-dialog"
    (onHide)="closeDemoForm()"
  >
    <ng-template pTemplate="header">
      <div class="demo-modal-header">
        <div>
          <div class="hero-brand">
            <span class="hero-brand-wordmark">North Edge</span>
            <span class="hero-brand-crm">CRM</span>
          </div>
          <h3>Schedule a Demo</h3>
          <p>Share your context and preferred time. Our team will confirm your session.</p>
        </div>
      </div>
    </ng-template>

    <form class="demo-form" [formGroup]="demoForm" (ngSubmit)="submitDemoRequest()">
      <div class="field-grid">
        <div class="form-field">
          <p-iftalabel>
            <input pInputText id="demo-full-name" type="text" formControlName="fullName" placeholder="Jane Cooper" class="w-full demo-input" />
            <label for="demo-full-name">Full name</label>
          </p-iftalabel>
          <small class="form-error" *ngIf="fieldError('fullName', 'required')">Full name is required.</small>
        </div>

        <div class="form-field">
          <p-iftalabel>
            <input pInputText id="demo-work-email" type="email" formControlName="workEmail" placeholder="jane@company.com" class="w-full demo-input" />
            <label for="demo-work-email">Work email</label>
          </p-iftalabel>
          <small class="form-error" *ngIf="fieldError('workEmail', 'required')">Work email is required.</small>
          <small class="form-error" *ngIf="fieldError('workEmail', 'email')">Enter a valid email address.</small>
        </div>

        <div class="form-field">
          <p-iftalabel>
            <input pInputText id="demo-company" type="text" formControlName="company" placeholder="North Ridge Foods" class="w-full demo-input" />
            <label for="demo-company">Company</label>
          </p-iftalabel>
          <small class="form-error" *ngIf="fieldError('company', 'required')">Company is required.</small>
        </div>

        <div class="form-field">
          <p-iftalabel>
            <input pInputText id="demo-role-title" type="text" formControlName="roleTitle" placeholder="VP Sales" class="w-full demo-input" />
            <label for="demo-role-title">Role / Title</label>
          </p-iftalabel>
          <small class="form-error" *ngIf="fieldError('roleTitle', 'required')">Role or title is required.</small>
        </div>

        <div class="form-field">
          <p-iftalabel>
            <input pInputText id="demo-phone" type="text" formControlName="phone" placeholder="+1 555 0100" class="w-full demo-input" />
            <label for="demo-phone">Phone</label>
          </p-iftalabel>
          <small class="form-error" *ngIf="fieldError('phone', 'required')">Phone is required.</small>
        </div>

        <div class="form-field">
          <p-iftalabel>
            <p-select
              inputId="demo-team-size"
              appendTo="body"
              [options]="teamSizeOptions"
              optionLabel="label"
              optionValue="value"
              formControlName="teamSize"
              placeholder="Select team size"
              styleClass="w-full"
            ></p-select>
            <label for="demo-team-size">Team size</label>
          </p-iftalabel>
          <small class="form-error" *ngIf="fieldError('teamSize', 'required')">Select a team size.</small>
        </div>

        <div class="form-field">
          <p-iftalabel>
            <p-datepicker
              inputId="demo-preferred-datetime"
              appendTo="body"
              formControlName="preferredDateTime"
              [minDate]="minDemoDateTime"
              [showIcon]="true"
              [showTime]="true"
              hourFormat="12"
              [showButtonBar]="true"
              dateFormat="yy-mm-dd"
              placeholder="Select preferred date and time"
              styleClass="w-full"
            ></p-datepicker>
            <label for="demo-preferred-datetime">Preferred date and time</label>
          </p-iftalabel>
          <small class="form-error" *ngIf="fieldError('preferredDateTime', 'required')">Preferred date/time is required.</small>
          <small class="form-error" *ngIf="fieldError('preferredDateTime', 'minTorontoDay')">Select a date from the next Toronto day onward.</small>
          <small class="form-error" *ngIf="fieldError('preferredDateTime', 'outsideTorontoBusinessHours')">Select a time between 9:00 AM and 5:00 PM Toronto time.</small>
        </div>

        <div class="form-field">
          <p-iftalabel>
            <p-select
              inputId="demo-timezone"
              appendTo="body"
              [options]="timezoneOptions"
              optionLabel="label"
              optionValue="value"
              formControlName="timezone"
              placeholder="Select timezone"
              [filter]="true"
              filterBy="label"
              styleClass="w-full"
            ></p-select>
            <label for="demo-timezone">Timezone (stored)</label>
          </p-iftalabel>
          <small class="form-error" *ngIf="fieldError('timezone', 'required')">Timezone is required.</small>
          <small class="form-error" *ngIf="fieldError('preferredDateTime', 'invalidTimezone')">Select a valid timezone.</small>
        </div>
      </div>

      <div class="field-textarea">
        <p-iftalabel>
          <textarea pTextarea id="demo-use-case" rows="4" formControlName="useCase" placeholder="What outcomes do you want from the demo?" class="w-full demo-textarea"></textarea>
          <label for="demo-use-case">Goals / use case</label>
        </p-iftalabel>
        <small class="form-error" *ngIf="fieldError('useCase', 'required')">Please share your use case.</small>
      </div>

      <div class="demo-actions">
        <button pButton type="button" label="Cancel" class="ne-btn ne-btn--link" (click)="closeDemoForm()" [disabled]="submittingDemo"></button>
        <button pButton type="submit" [label]="submittingDemo ? 'Submitting...' : 'Schedule Demo'" class="ne-btn ne-btn--primary" [disabled]="submittingDemo"></button>
      </div>

      <p class="demo-contact-note">
        Prefer email? Contact us at
        <a href="mailto:contact@northedgesystem.com">contact@northedgesystem.com</a>
      </p>
    </form>
  </p-dialog>

  <p-dialog
    [(visible)]="showDemoSuccess"
    [modal]="true"
    [dismissableMask]="false"
    [draggable]="false"
    [resizable]="false"
    [closeOnEscape]="true"
    [style]="{ width: 'min(560px, 92vw)' }"
    styleClass="demo-success-dialog"
  >
    <ng-template pTemplate="header">
      <div class="demo-success-header">
        <div class="hero-brand">
          <span class="hero-brand-wordmark">North Edge</span>
          <span class="hero-brand-crm">CRM</span>
        </div>
        <h3>Thanks for contacting us</h3>
      </div>
    </ng-template>
    <div class="demo-success-body">
      <p>Your demo request has been submitted successfully.</p>
      <p>Our team will contact you soon to confirm your session.</p>
    </div>
    <ng-template pTemplate="footer">
      <button pButton type="button" label="Done" class="ne-btn ne-btn--primary" (click)="showDemoSuccess = false"></button>
    </ng-template>
  </p-dialog>
</main>
