<div class="rfq-history">
  <header class="page-header">
    <div>
      <span class="eyebrow">RFQ Archive</span>
      <h1>RFQ History</h1>
      <p>
        Explore closed and in-progress RFQs, track invited suppliers, and surface insights for the next sourcing cycle.
      </p>
    </div>
    <div class="header-actions">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input
          pInputText
          type="text"
          placeholder="Search RFQ, title, or requester…"
          [(ngModel)]="searchTerm"
        />
      </span>
      <p-button
        label="Export"
        icon="pi pi-download"
        styleClass="p-button-rounded p-button-outlined"
      />
    </div>
  </header>

  <section class="filters">
    <p-select
      [(ngModel)]="selectedStatus"
      [options]="statusOptions"
      optionLabel="label"
      optionValue="value"
      placeholder="All Statuses"
    ></p-select>
    <p-select
      [(ngModel)]="selectedCategory"
      [options]="categoryOptions"
      optionLabel="label"
      optionValue="value"
      placeholder="All Categories"
    ></p-select>
  </section>

  <section class="history-table">
    <p-table [value]="filteredHistory" responsiveLayout="scroll" [tableStyle]="{ 'min-width': '68rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th>RFQ</th>
          <th>Requester</th>
          <th>Timeline</th>
          <th>Status</th>
          <th>Suppliers</th>
          <th>Savings</th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>
            <div class="ref">
              <span class="id">{{ item.rfqId }}</span>
              <span class="title">{{ item.title }}</span>
              <span class="category">{{ item.category }}</span>
            </div>
          </td>
          <td>
            <div class="requester">
              <i class="pi pi-user"></i>
              <span>{{ item.requester }}</span>
            </div>
          </td>
          <td>
            <div class="timeline">
              <span>{{ item.createdOn }}</span>
              <i class="pi pi-arrow-right"></i>
              <span>{{ item.closedOn }}</span>
            </div>
          </td>
          <td>
            <p-tag
              [value]="item.status"
              [severity]="
                item.status === 'Awarded'
                  ? 'success'
                  : item.status === 'Cancelled'
                  ? 'secondary'
                  : 'info'
              "
            ></p-tag>
          </td>
          <td>
            <span class="suppliers">
              Invited {{ item.suppliersInvited }} · Quotes {{ item.quotesReceived }}
            </span>
            <div class="chips">
              <p-chip *ngFor="let tag of item.tags" [label]="tag"></p-chip>
            </div>
          </td>
          <td>{{ item.savingsAchieved }}</td>
          <td class="row-actions">
            <p-button
              icon="pi pi-external-link"
              label="Open"
              size="small"
              (onClick)="openRfq(item.rfqId)"
            ></p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </section>
</div>
