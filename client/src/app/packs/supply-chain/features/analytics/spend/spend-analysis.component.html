<div class="page-background">
  <div class="animated-orb orb-1"></div>
  <div class="animated-orb orb-2"></div>
  <div class="animated-orb orb-3"></div>
  <div class="animated-orb orb-4"></div>
</div>

<div class="page-container">
  <div class="page-content spend-analysis">
    <app-breadcrumbs></app-breadcrumbs>

    <section class="hero-section">
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="page-title gradient-indigo">Spend Analysis</h1>
          <p class="page-subtitle">Spot category shifts, surface savings opportunities, and coordinate sourcing actions.</p>
        </div>
        <div class="hero-actions">
          <p-button label="Download report" icon="pi pi-download" styleClass="btn-glass"></p-button>
          <p-button label="Share insights" icon="pi pi-send" styleClass="btn-gradient"></p-button>
        </div>
      </div>
    </section>

    <section class="glass-card hero-metrics">
      <div class="metric-card total">
        <span class="metric-label">Total spend (rolling 12m)</span>
        <div class="metric-value">${{ totalSpend() | number:'1.1-1' }}M</div>
      </div>
      <div class="metric-card expanding">
        <span class="metric-label">Expanding categories</span>
        <div class="metric-value">{{ expandingCount() }}</div>
        <small>Coordinate sourcing plans to manage growth</small>
      </div>
    </section>

    <section class="glass-card category-card">
      <div class="card-header">
        <h2 class="card-title">Category mix</h2>
        <p-button label="Benchmark" icon="pi pi-chart-pie" [text]="true"></p-button>
      </div>
      <div class="card-body">
        <p-table [value]="categories()" responsiveLayout="scroll" dataKey="category">
          <ng-template pTemplate="header">
            <tr>
              <th>Category</th>
              <th>Spend (USD M)</th>
              <th>Share</th>
              <th>Change vs LY</th>
              <th>Suppliers</th>
              <th>Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-category>
            <tr>
              <td>{{ category.category }}</td>
              <td>{{ category.spend | number:'1.1-1' }}</td>
              <td>
                <div class="progress-wrap">
                  <p-progressBar [value]="category.percent"></p-progressBar>
                  <small>{{ category.percent }}%</small>
                </div>
              </td>
              <td>
                <span [ngClass]="{ up: category.change > 0, down: category.change < 0 }">
                  {{ category.change > 0 ? '+' : '' }}{{ category.change }}%
                </span>
              </td>
              <td>{{ category.suppliers }}</td>
              <td>
                <p-tag [value]="category.status" [severity]="statusSeverity(category.status)"></p-tag>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </section>

    <section class="glass-card opportunity-card">
      <div class="card-header">
        <h2 class="card-title">Savings & cost management pipeline</h2>
        <p-button label="View roadmap" icon="pi pi-diagram-tree" [text]="true"></p-button>
      </div>
      <div class="card-body">
        <div class="opportunity-grid">
          <div class="opportunity-tile" *ngFor="let item of opportunities()">
            <span class="title">{{ item.title }}</span>
            <span class="impact">{{ item.impact }}</span>
            <div class="meta">
              <span>{{ item.owner }}</span>
              <span>{{ item.due }}</span>
            </div>
            <div class="tag-strip">
              <p-chip *ngFor="let tag of item.tags" [label]="tag"></p-chip>
            </div>
            <p-tag [value]="item.status" [severity]="opportunitySeverity(item.status)"></p-tag>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
