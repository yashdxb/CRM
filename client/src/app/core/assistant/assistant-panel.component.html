<aside
  class="assistant-panel glass-card"
  *ngIf="assistantVisible()"
  [class.collapsed]="assistantCollapsed()"
  cdkDrag
>
  <div class="assistant-header" cdkDragHandle>
    <div class="assistant-title">
      <span class="assistant-icon">
        <i class="pi pi-bolt"></i>
      </span>
      <div>
        <h3>AI Assistant</h3>
      </div>
    </div>
    <div class="assistant-controls">
      <button
        type="button"
        class="assistant-history"
        [disabled]="historyLoading()"
        (click)="loadHistory()"
      >
        {{ historyLoaded() ? 'History loaded' : historyLoading() ? 'Loading…' : 'View history' }}
      </button>
      <button type="button" class="assistant-control" (click)="toggleAssistantCollapsed()">
        <i class="pi" [class.pi-minus]="!assistantCollapsed()" [class.pi-plus]="assistantCollapsed()"></i>
      </button>
      <button type="button" class="assistant-control" (click)="hideAssistant()">
        <i class="pi pi-times"></i>
      </button>
    </div>
  </div>
  <div class="assistant-body">
        <div class="assistant-message">
          <span class="assistant-role">Assistant</span>
          <div class="assistant-content" [innerHTML]="formatAssistantMessage(assistantGreeting())"></div>
        </div>
        <div
          class="assistant-message"
          *ngFor="let message of assistantMessages()"
          [class.user]="message.role === 'user'"
        >
          <span class="assistant-role">{{ message.role === 'user' ? 'You' : 'Assistant' }}</span>
          <div class="assistant-content" [innerHTML]="formatAssistantMessage(message.content)"></div>
        </div>
        <div class="assistant-message thinking" *ngIf="assistantSending()">
          <span class="assistant-role">Assistant</span>
          <div class="assistant-content">
            Thinking
            <span class="thinking-dots">
              <span></span><span></span><span></span>
            </span>
          </div>
        </div>
        <div class="assistant-message" *ngIf="assistantError()">
          <span class="assistant-role">Assistant</span>
          <div class="assistant-content">{{ assistantError() }}</div>
        </div>
      </div>
  <div class="assistant-input">
    <input
      type="text"
      placeholder="Ask AI Assistant…"
      [disabled]="assistantSending()"
      [ngModel]="assistantInput()"
      (ngModelChange)="assistantInput.set($event)"
      (keydown)="onAssistantInputKeydown($event)"
    />
    <button type="button" class="assistant-send" [disabled]="assistantSending()" (click)="sendAssistantMessage()">
      <i class="pi pi-send"></i>
    </button>
  </div>
</aside>
