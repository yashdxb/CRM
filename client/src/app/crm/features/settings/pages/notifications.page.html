<section class="page-background">
  <div class="animated-orb orb-1"></div>
  <div class="animated-orb orb-2"></div>
  <div class="animated-orb orb-3"></div>

  <app-breadcrumbs></app-breadcrumbs>

  <header class="page-hero">
    <div class="hero-content">
      <span class="hero-eyebrow">
        <i class="pi pi-bell"></i>
        Notifications
      </span>
      <h1 class="hero-title">
        <span class="title-gradient">Notification</span>
        <span class="title-light">Preferences</span>
      </h1>
      <p class="hero-subtitle">
        Tune your alerts so the team gets the right signal at the right time.
      </p>
    </div>
    <div class="hero-actions">
      <button pButton type="button" class="crm-button crm-button--ghost" (click)="resetPreferences()">
        Reset defaults
      </button>
    </div>
  </header>

  <div class="preferences-grid">
    <div class="glass-card preference-panel">
      <div class="panel-header">
        <div>
          <span class="panel-eyebrow">In-app alerts</span>
          <h2>Inbox + toast notifications</h2>
        </div>
        <span class="panel-pill">Live</span>
      </div>
      <div class="panel-body">
        <div class="preference-row" *ngFor="let option of options">
          <div class="preference-info">
            <div class="preference-icon">
              <i [class]="option.icon"></i>
            </div>
            <div>
              <div class="preference-title">{{ option.label }}</div>
              <div class="preference-subtitle">{{ option.description }}</div>
            </div>
          </div>
          <p-toggleSwitch
            [ngModel]="getPreference('inApp', option.key)"
            (ngModelChange)="setPreference('inApp', option.key, $event)"
            [ngModelOptions]="{ standalone: true }"
          ></p-toggleSwitch>
        </div>
      </div>
    </div>

    <div class="glass-card preference-panel">
      <div class="panel-header">
        <div>
          <span class="panel-eyebrow">Email alerts</span>
          <h2>Email notifications</h2>
        </div>
        <span class="panel-pill">Live</span>
      </div>
      <div class="panel-body">
        <div class="preference-row preference-row--compact">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-bell"></i>
            </div>
            <div>
              <div class="preference-title">SLA + idle deal alerts</div>
              <div class="preference-subtitle">Enable escalation emails for SLA breaches, idle deals, and coaching overdue tasks.</div>
            </div>
          </div>
          <p-toggleSwitch
            [ngModel]="alertsEnabled"
            (ngModelChange)="toggleAlertsEnabled($event)"
            [ngModelOptions]="{ standalone: true }"
          ></p-toggleSwitch>
        </div>
        <div class="preference-divider"></div>
        <div class="preference-row">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-stopwatch"></i>
            </div>
            <div>
              <div class="preference-title">Lead SLA breach</div>
              <div class="preference-subtitle">Email when first-touch SLA is missed.</div>
            </div>
          </div>
          <p-toggleSwitch
            [ngModel]="preferences().emailAlerts.leadSla"
            (ngModelChange)="toggleEmailAlert('leadSla', $event)"
            [ngModelOptions]="{ standalone: true }"
          ></p-toggleSwitch>
        </div>
        <div class="preference-row">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-clock"></i>
            </div>
            <div>
              <div class="preference-title">Idle deal alert</div>
              <div class="preference-subtitle">Email when opportunities are missing next steps or inactive beyond the threshold.</div>
            </div>
          </div>
          <p-toggleSwitch
            [ngModel]="preferences().emailAlerts.idleDeal"
            (ngModelChange)="toggleEmailAlert('idleDeal', $event)"
            [ngModelOptions]="{ standalone: true }"
          ></p-toggleSwitch>
        </div>
        <div class="preference-row preference-row--compact">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-list-check"></i>
            </div>
            <div>
              <div class="preference-title">No next step</div>
              <div class="preference-subtitle">Alert when an open opportunity has no next step scheduled.</div>
            </div>
          </div>
          <p-toggleSwitch
            [ngModel]="preferences().emailAlerts.idleDealNoNextStep"
            (ngModelChange)="toggleEmailAlert('idleDealNoNextStep', $event)"
            [disabled]="!alertsEnabled || !preferences().emailAlerts.idleDeal"
            [ngModelOptions]="{ standalone: true }"
          ></p-toggleSwitch>
        </div>
        <div class="preference-row preference-row--compact">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-hourglass"></i>
            </div>
            <div>
              <div class="preference-title">No activity threshold</div>
              <div class="preference-subtitle">Alert when there is no activity for the selected number of days.</div>
            </div>
          </div>
          <p-toggleSwitch
            [ngModel]="preferences().emailAlerts.idleDealNoActivity"
            (ngModelChange)="toggleEmailAlert('idleDealNoActivity', $event)"
            [disabled]="!alertsEnabled || !preferences().emailAlerts.idleDeal"
            [ngModelOptions]="{ standalone: true }"
          ></p-toggleSwitch>
        </div>
        <div class="preference-row">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-flag"></i>
            </div>
            <div>
              <div class="preference-title">Coaching escalation</div>
              <div class="preference-subtitle">Email managers when coaching tasks are overdue.</div>
            </div>
          </div>
          <p-toggleSwitch
            [ngModel]="preferences().emailAlerts.coachingEscalation"
            (ngModelChange)="toggleEmailAlert('coachingEscalation', $event)"
            [ngModelOptions]="{ standalone: true }"
          ></p-toggleSwitch>
        </div>
        <div class="preference-divider"></div>
        <div class="preference-row">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-calendar"></i>
            </div>
            <div>
              <div class="preference-title">No-activity threshold (days)</div>
              <div class="preference-subtitle">Number of inactive days before alerting.</div>
            </div>
          </div>
          <input
            pInputText
            type="number"
            min="1"
            [ngModel]="preferences().emailAlerts.idleDealDays"
            (ngModelChange)="updateEmailAlertValue('idleDealDays', $event)"
            [disabled]="!alertsEnabled || !preferences().emailAlerts.idleDeal || !preferences().emailAlerts.idleDealNoActivity"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
        <div class="preference-row">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-refresh"></i>
            </div>
            <div>
              <div class="preference-title">Idle deal cooldown (days)</div>
              <div class="preference-subtitle">Minimum days between repeated alerts.</div>
            </div>
          </div>
          <input
            pInputText
            type="number"
            min="1"
            [ngModel]="preferences().emailAlerts.idleDealCooldownDays"
            (ngModelChange)="updateEmailAlertValue('idleDealCooldownDays', $event)"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
        <div class="preference-row">
          <div class="preference-info">
            <div class="preference-icon">
              <i class="pi pi-refresh"></i>
            </div>
            <div>
              <div class="preference-title">Coaching cooldown (days)</div>
              <div class="preference-subtitle">Minimum days between coaching escalation emails.</div>
            </div>
          </div>
          <input
            pInputText
            type="number"
            min="1"
            [ngModel]="preferences().emailAlerts.coachingEscalationCooldownDays"
            (ngModelChange)="updateEmailAlertValue('coachingEscalationCooldownDays', $event)"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
        <div class="preference-divider"></div>
        <div class="preference-row" *ngFor="let option of options">
          <div class="preference-info">
            <div class="preference-icon">
              <i [class]="option.icon"></i>
            </div>
            <div>
              <div class="preference-title">{{ option.label }}</div>
              <div class="preference-subtitle">{{ option.description }}</div>
            </div>
          </div>
          <p-toggleSwitch
            [ngModel]="getPreference('email', option.key)"
            (ngModelChange)="setPreference('email', option.key, $event)"
            [ngModelOptions]="{ standalone: true }"
          ></p-toggleSwitch>
        </div>
        <p class="panel-note" *ngIf="emailDisabled()">
          Email notifications are currently disabled. Toggle the switches to enable delivery.
        </p>
      </div>
    </div>
  </div>
</section>
