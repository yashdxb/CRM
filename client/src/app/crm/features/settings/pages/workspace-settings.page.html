<!-- ═══════════════════════════════════════════════════════════════════════════
     WORKSPACE SETTINGS PAGE - Premium Glass UI with Design System
     ═══════════════════════════════════════════════════════════════════════════ -->
<div class="page-container">
  <!-- Animated Background Orbs -->
  <div class="bg-orbs">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>

  <!-- Breadcrumb -->
  <app-breadcrumbs></app-breadcrumbs>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       HERO SECTION
       ═══════════════════════════════════════════════════════════════════════════ -->
  <section class="hero-section">
    <div class="hero-content">
      <div class="hero-badge">
        <span class="badge-dot"></span>
        <span>Workspace</span>
      </div>
      
      <h1 class="hero-title">
        <span class="title-gradient">Workspace</span>
        <span class="title-light">Configuration</span>
      </h1>
      
      <p class="hero-description">
        Set the company name, time zone, and currency that shape every record in the CRM.
      </p>

      <div class="hero-actions">
        <button pButton type="button" class="btn btn-secondary" routerLink="/app/settings">
          <i class="pi pi-arrow-left"></i>
          <span>Back to Settings</span>
        </button>
        <button pButton type="button" class="btn btn-secondary" routerLink="/app/settings/roles">
          <i class="pi pi-shield"></i>
          <span>Manage Roles</span>
        </button>
        <button pButton type="button" class="btn btn-ghost" [disabled]="loading()" (click)="loadSettings()">
          <i class="pi pi-refresh"></i>
          <span>Reload</span>
        </button>
      </div>
    </div>

    <div class="hero-visual">
      <div class="visual-card visual-card--primary">
        <div class="card-icon">
          <i class="pi pi-building"></i>
        </div>
        <div class="card-content">
          <span class="card-label">Active Workspace</span>
          <strong class="card-value">{{ settingsForm.value.name || 'Untitled' }}</strong>
          <span class="card-trend">
            <i class="pi pi-check-circle"></i> Configured
          </span>
        </div>
        <div class="card-glow"></div>
      </div>

      <div class="visual-card visual-card--secondary">
        <div class="card-icon">
          <i class="pi pi-cog"></i>
        </div>
      <div class="card-content">
        <span class="card-label">Settings</span>
        <strong class="card-value">5</strong>
        <span class="card-trend">
          <i class="pi pi-sliders-h"></i> Configurable options
        </span>
      </div>
        <div class="card-glow"></div>
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       METRICS DASHBOARD
       ═══════════════════════════════════════════════════════════════════════════ -->
  <section class="metrics-section">
    <div class="metric-card metric-card--total">
      <div class="metric-icon">
        <i class="pi pi-building"></i>
      </div>
      <div class="metric-content">
        <span class="metric-label">Workspace</span>
        <strong class="metric-value">{{ settingsForm.value.name ? '1' : '0' }}</strong>
      </div>
      <div class="metric-ring">
        <svg viewBox="0 0 36 36">
          <path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
          <path class="ring-fill ring-fill--purple" 
            [attr.stroke-dasharray]="(settingsForm.value.name ? 100 : 0) + ', 100'"
            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
        </svg>
      </div>
    </div>

    <div class="metric-card metric-card--leads">
      <div class="metric-icon">
        <i class="pi pi-clock"></i>
      </div>
      <div class="metric-content">
        <span class="metric-label">Time Zone</span>
        <strong class="metric-value">{{ settingsForm.value.timeZone || 'UTC' }}</strong>
      </div>
      <div class="metric-ring">
        <svg viewBox="0 0 36 36">
          <path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
          <path class="ring-fill ring-fill--cyan" 
            stroke-dasharray="100, 100"
            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
        </svg>
      </div>
    </div>

    <div class="metric-card metric-card--customers">
      <div class="metric-icon">
        <i class="pi pi-dollar"></i>
      </div>
      <div class="metric-content">
        <span class="metric-label">Currency</span>
        <strong class="metric-value">{{ settingsForm.value.currency || 'USD' }}</strong>
      </div>
      <div class="metric-ring">
        <svg viewBox="0 0 36 36">
          <path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
          <path class="ring-fill ring-fill--green" 
            stroke-dasharray="100, 100"
            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
        </svg>
      </div>
    </div>

  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       SETTINGS FORM SECTION
       ═══════════════════════════════════════════════════════════════════════════ -->
  <section class="data-section">
    <div class="settings-layout">
      <!-- Form Card -->
      <div class="data-card">
        <div class="data-header">
          <div class="header-title">
            <h2>Workspace Profile</h2>
            <span class="record-count">Configure your tenant defaults</span>
          </div>
          <div class="header-actions">
            <span class="status-badge status-badge--success" *ngIf="!loading()">
              <i class="pi pi-check"></i> Active
            </span>
          </div>
        </div>

        <!-- Loading State -->
        <div class="loading-state" *ngIf="loading()">
          <div class="skeleton-row" *ngFor="let _ of [0, 1, 2]">
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-input"></div>
          </div>
        </div>

        <!-- Form -->
        <form class="settings-form" *ngIf="!loading()" [formGroup]="settingsForm" (ngSubmit)="saveSettings()">
          <section class="form-card">
            <h3 class="section-title">
              <i class="pi pi-building"></i>
              Company Information
            </h3>
            <p class="section-description">Basic workspace identity settings</p>
            
            <div class="form-grid">
              <div class="field">
                <label>Company Name <span class="required">*</span></label>
                <input pInputText formControlName="name" placeholder="Acme CRM Workspace" class="w-full" />
                <small class="field-hint">The display name for your workspace</small>
              </div>
            </div>
          </section>

          <section class="form-card">
            <h3 class="section-title section-title--warning">
              <i class="pi pi-stopwatch"></i>
              Lead SLA
            </h3>
            <p class="section-description">Define how quickly new leads must be contacted</p>

            <div class="form-grid form-grid--2col">
              <div class="field">
                <label>First-touch SLA (hours)</label>
                <input
                  pInputText
                  type="number"
                  min="1"
                  max="168"
                  formControlName="leadFirstTouchSlaHours"
                  placeholder="24"
                  class="w-full"
                />
                <small class="field-hint">Default is 24 hours. Used to create first-touch tasks and SLA alerts.</small>
              </div>
            </div>
          </section>

          <section class="form-card">
            <h3 class="section-title section-title--info">
              <i class="pi pi-globe"></i>
              Regional Settings
            </h3>
            <p class="section-description">Time zone and currency preferences</p>
            
            <div class="form-grid form-grid--2col">
              <div class="field">
                <label>Time Zone <span class="required">*</span></label>
                <p-select appendTo="body"
                  [options]="timeZoneOptions"
                  optionLabel="label"
                  optionValue="value"
                  formControlName="timeZone"
                  placeholder="Select time zone"
                  styleClass="w-full"
                  [filter]="true"
                  filterBy="label"
                  filterPlaceholder="Search time zones"
                >
                  <ng-template pTemplate="item" let-option>
                    <div class="timezone-option">
                      <img
                        class="timezone-flag"
                        [src]="getFlagUrl(option?.flagCode)"
                        [alt]="option?.flagCode ? option.flagCode.toUpperCase() + ' flag' : 'Flag'"
                        width="18"
                        height="12"
                        loading="lazy"
                      />
                      <span>{{ option.label }}</span>
                    </div>
                  </ng-template>
                  <ng-template pTemplate="selectedItem" let-option>
                    <div class="timezone-option">
                      <img
                        class="timezone-flag"
                        [src]="getFlagUrl(option?.flagCode)"
                        [alt]="option?.flagCode ? option.flagCode.toUpperCase() + ' flag' : 'Flag'"
                        width="18"
                        height="12"
                        loading="lazy"
                      />
                      <span>{{ option?.label }}</span>
                    </div>
                  </ng-template>
                </p-select>
                <small class="field-hint">Used for date/time display across the system</small>
              </div>

              <div class="field">
                <label>Currency <span class="required">*</span></label>
                <p-select appendTo="body"
                  [options]="currencyOptions"
                  optionLabel="label"
                  optionValue="value"
                  formControlName="currency"
                  placeholder="Select currency"
                  styleClass="w-full"
                ></p-select>
                <small class="field-hint">Default currency for monetary values</small>
              </div>
            </div>
          </section>

          <div class="form-actions">
            <button type="button" class="btn btn-ghost" (click)="loadSettings()" [disabled]="loading()">
              <i class="pi pi-refresh"></i>
              Reset
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="saving() || !canManageAdmin()">
              <i class="pi pi-save" *ngIf="!saving()"></i>
              <i class="pi pi-spinner pi-spin" *ngIf="saving()"></i>
              {{ saving() ? 'Saving...' : 'Save Settings' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Preview Card -->
      <aside class="preview-card" *ngIf="!loading()">
        <div class="preview-header">
          <div class="preview-title">
            <i class="pi pi-eye"></i>
            <h3>Live Preview</h3>
          </div>
          <span class="status-badge status-badge--success">Active</span>
        </div>

        <div class="preview-workspace">
          <div class="preview-icon">
            <i class="pi pi-building"></i>
          </div>
          <div class="preview-info">
            <span class="preview-label">Workspace</span>
            <strong class="preview-value">{{ settingsForm.value.name || 'Untitled workspace' }}</strong>
          </div>
        </div>

        <div class="preview-grid">
          <div class="preview-item">
            <div class="preview-item-icon">
              <i class="pi pi-clock"></i>
            </div>
            <div>
              <span class="preview-item-label">Time Zone</span>
              <strong class="preview-item-value">{{ settingsForm.value.timeZone || 'UTC' }}</strong>
            </div>
          </div>

          <div class="preview-item">
            <div class="preview-item-icon preview-item-icon--success">
              <i class="pi pi-dollar"></i>
            </div>
            <div>
              <span class="preview-item-label">Currency</span>
              <strong class="preview-item-value">{{ settingsForm.value.currency || 'USD' }}</strong>
            </div>
          </div>
        </div>

        <div class="preview-note">
          <i class="pi pi-info-circle"></i>
          <span>These defaults apply to new records and pipeline metrics.</span>
        </div>
      </aside>
    </div>
  </section>
</div>
